<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=968">
    <title>G.C.E.A-L.Ready - තරු ක්‍රමය</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <style>
        :root {
            --primary-bg: #f5f5f5;
            --secondary-bg: #ffffff;
            --text-color: #333333;
            --border-color: #dddddd;
            --highlight: #3498db;
            --stream-science: #4caf50;
            --stream-commerce: #2196f3;
            --stream-arts: #ff9800;
            --star-color: #ffd700;
            --header-bg: #184e77;
            --calendar-header: #1e6091;
        }

        .dark-theme {
            --primary-bg: #121212;
            --secondary-bg: #1e1e1e;
            --text-color: #f5f5f5;
            --border-color: #333333;
            --highlight: #2980b9;
            --header-bg: #0d2b45;
            --calendar-header: #14395a;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--primary-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        header {
            background-color: var(--header-bg);
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: white;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            animation: logoShine 2s infinite alternate;
        }

        @keyframes logoShine {
            from {
                text-shadow: 0 0 5px rgba(255,255,255,0.5);
            }
            to {
                text-shadow: 0 0 15px rgba(255,255,255,0.8), 0 0 20px rgba(52, 152, 219, 0.8);
            }
        }

        .theme-toggle {
            display: inline-block;
            padding: 12px 30px;
            font-size: 20px;
            color: #111;
            background-color: #00f7ff;
            border: 2px solid #00f7ff;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            text-shadow: 0 0 8px #00f7ff, 0 0 12px #00f7ff;
            box-shadow: 0 0 10px #00f7ff, 0 0 20px #00f7ff inset;
            transition: 0.3s ease;
        }

        .theme-toggle:hover {
            background-color: #00f7ff;
            color: #111;
            box-shadow: 0 0 20px #00f7ff, 0 0 30px #00f7ff, 0 0 40px #00f7ff;
            transform: scale(1.05);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1, h2, h3 {
            color: var(--highlight);
        }

        h1.main-title {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            color: var(--highlight);
            animation: titlePulse 3s infinite alternate;
        }

        @keyframes titlePulse {
            0% {
                transform: scale(1);
                text-shadow: 0 0 5px rgba(52, 152, 219, 0.5);
            }
            100% {
                transform: scale(1.03);
                text-shadow: 0 0 15px rgba(52, 152, 219, 0.8);
            }
        }

        h1.main-title .sinhalese {
            display: block;
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        /* Month tabs styling */
        .month-tabs {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 2rem;
            gap: 0.5rem;
        }

        .month-tab {
            background-color: var(--secondary-bg);
            border: 1px solid var(--border-color);
            padding: 0.75rem 1.5rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .month-tab:hover {
            background-color: var(--highlight);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .month-tab.active {
            background-color: var(--highlight);
            color: white;
            font-weight: bold;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* Calendar styling */
        .calendar-container {
            background-color: var(--secondary-bg);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .calendar-container:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .calendar-header {
            background-color: var(--calendar-header);
            color: white;
            padding: 1rem;
            border-radius: 8px 8px 0 0;
            margin: -2rem -2rem 2rem -2rem;
            text-align: center;
            font-size: 1.5rem;
        }

        .weekday-header {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            text-align: center;
            font-weight: bold;
            background-color: var(--primary-bg);
            border-radius: 4px;
            padding: 0.5rem 0;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .calendar-grid.with-gap {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            grid-column-gap: 0.5rem;
            grid-row-gap: 0.5rem;
        }

        .grid-placeholder {
            visibility: hidden;
        }

        .day-card {
            background-color: var(--primary-bg);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .day-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .day-card.today {
            border: 2px solid var(--highlight);
            box-shadow: 0 0 8px rgba(52, 152, 219, 0.5);
        }

        .day-card.today:before {
            content: "Today";
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--highlight);
            color: white;
            font-size: 0.7rem;
            padding: 2px 5px;
            border-radius: 0 0 0 5px;
        }

        .day-number {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .time-input {
            width: 80%;
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
            background-color: var(--secondary-bg);
            color: var(--text-color);
            text-align: center;
        }

        .stars-display {
            min-height: 2rem;
            font-size: 1.2rem;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 3px;
        }

        .subject-star {
            animation: starPulse 2s infinite alternate;
            transition: transform 0.3s ease;
        }

        .subject-star:hover {
            transform: scale(1.2);
            animation: starGlow 1s infinite alternate;
        }

        @keyframes starPulse {
            0% {
                transform: scale(1);
                opacity: 0.9;
            }
            100% {
                transform: scale(1.1);
                opacity: 1;
            }
        }

        @keyframes starGlow {
            0% {
                filter: drop-shadow(0 0 2px currentColor);
            }
            100% {
                filter: drop-shadow(0 0 5px currentColor);
            }
        }

        /* Data Entry Form */
        .data-entry {
            background-color: var(--secondary-bg);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .data-entry:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .form-row {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .form-row label {
            flex: 0 0 100px;
        }

        .form-row select, .form-row input {
            flex: 1;
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid var(--border-color);
            background-color: var(--primary-bg);
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .form-row select:focus, .form-row input:focus {
            border-color: var(--highlight);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            outline: none;
        }

        .form-row button {
            background-color: var(--highlight);
            color: white;
            border: none;
            padding: 0.5rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .form-row button:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        .form-row button:active {
            transform: translateY(0);
        }

        /* Legend for subject colors */
        .color-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            padding: 1rem;
            background-color: var(--secondary-bg);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .color-legend:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .color-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .color-item:hover {
            transform: translateY(-2px);
        }

        .color-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .color-item:hover .color-dot {
            transform: scale(1.2);
            box-shadow: 0 0 8px currentColor;
        }

        footer {
            text-align: center;
            padding: 1rem;
            background-color: var(--secondary-bg);
            color: var(--text-color);
            margin-top: 2rem;
        }

        /* Hide all months except the active one */
        .month-calendar {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .month-calendar.active {
            display: block;
        }

        /* Summary section */
        .summary-container {
            background-color: var(--secondary-bg);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .summary-container:hover {
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .summary-card {
            background-color: var(--primary-bg);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .subject-name {
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .progress-bar {
            height: 10px;
            background-color: var(--border-color);
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 0.5rem;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 1s ease-in-out;
            animation: progressPulse 2s infinite alternate;
        }

        @keyframes progressPulse {
            0% {
                opacity: 0.8;
            }
            100% {
                opacity: 1;
            }
        }

        /* Export button */
        .export-btn {
            display: block;
            margin: 2rem auto;
            background-color: var(--highlight);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .export-btn:hover {
            opacity: 0.9;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .export-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .export-btn::after {
            content: "";
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.7);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .export-btn:focus:not(:active)::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            20% {
                transform: scale(25, 25);
                opacity: 0.5;
            }
            100% {
                opacity: 0;
                transform: scale(40, 40);
            }
        }

        /* Alert message styling */
        .alert-message {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #ff5252;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
        }

        .alert-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Day stats tooltip */
        .day-stats {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0,0,0,0.7);
            color: white;
            font-size: 0.8rem;
            padding: 5px;
            border-radius: 0 0 8px 8px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .day-card:hover .day-stats {
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">A/l Mehewara</div>
        <button class="theme-toggle" id="themeToggle">Dark Theme</button>
    </header>

    <div class="container">
        <h1 class="main-title">
            <span class="sinhalese">තරු ක්‍රමය</span>
            Work Plan Star Sheet
        </h1>
        
        <div class="data-entry">
            <h2>Add Study Hours</h2>
            <div class="form-row">
                <label for="subjectSelect">Subject:</label>
                <select id="subjectSelect">
                    <option value="">Select subject</option>
                    <!-- Subjects will be populated by JavaScript -->
                </select>
            </div>
            <div class="form-row">
                <label for="dateSelect">Date:</label>
                <input type="date" id="dateSelect">
            </div>
            <div class="form-row">
                <label for="hoursInput">Hours:</label>
                <input type="number" id="hoursInput" min="0.25" max="24" step="0.25" placeholder="Hours studied (max 24h per day)">
            </div>
            <div class="form-row">
                <button id="addEntryBtn">Add Entry</button>
                <button id="clearAllBtn">Clear All Data</button>
            </div>
        </div>
        
        <div class="month-tabs" id="monthTabs">
            <div class="month-tab" data-month="april">April</div>
            <div class="month-tab" data-month="may">May</div>
            <div class="month-tab" data-month="june">June</div>
            <div class="month-tab" data-month="july">July</div>
            <div class="month-tab" data-month="august">August</div>
            <div class="month-tab" data-month="september">September</div>
            <div class="month-tab" data-month="october">October</div>
            <div class="month-tab" data-month="november">November</div>
        </div>
        
        <!-- Calendar containers for each month -->
        <div id="calendarContainers">
            <!-- Will be populated by JavaScript -->
        </div>
        
        <div class="summary-container">
            <h2>Study Summary</h2>
            <div class="summary-grid" id="subjectSummary">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>
        
        <div class="color-legend" id="colorLegend">
            <!-- Will be populated by JavaScript -->
        </div>
        
        <button class="export-btn" id="exportBtn">Export Study Data XL File</button>
    </div>
    
    <footer>
        &copy; 2025 G.C.E.A-L.Ready - Your A/L Mehewara
    </footer>

    <div id="alertMessage" class="alert-message"></div>
	
	<script>
       // Theme toggle functionality
		const themeToggleBtn = document.getElementById('themeToggle');
		const body = document.body;

		let isDarkTheme = false;

		themeToggleBtn.addEventListener('click', function() {
			isDarkTheme = !isDarkTheme;
			
			if (isDarkTheme) {
				body.classList.add('dark-theme');
				themeToggleBtn.textContent = 'Light Theme';
			} else {
				body.classList.remove('dark-theme');
				themeToggleBtn.textContent = 'Dark Theme';
			}
			
			// Save theme preference
			localStorage.setItem('darkTheme', isDarkTheme);
		});

		// Check for saved theme preference
		const savedTheme = localStorage.getItem('darkTheme') === 'true';
		if (savedTheme) {
			body.classList.add('dark-theme');
			themeToggleBtn.textContent = 'Light Theme';
			isDarkTheme = true;
		}

		// Function to save selected subjects to localStorage
		function saveSubjectsToLocalStorage(stream, category, subjects) {
			localStorage.setItem('selectedStream', stream);
			localStorage.setItem('selectedCategory', category);
			localStorage.setItem('selectedSubjects', JSON.stringify(subjects));
		}

		// Subject combinations from the main page
		const subjectCombinations = {
			science: {
				'physical': ['Combined Mathematics', 'Physics', 'Chemistry', 'General English', 'General IT'],
				'biological': ['Biology', 'Physics/Agriculture', 'Chemistry', 'General English', 'General IT'],
				'common': ['Combined Mathematics', 'Physics', 'ICT', 'General English', 'General IT']
			},
			commerce: {
				'first': ['Accounting', 'Business Studies', 'Economics', 'General English', 'General IT'],
				'second': ['Accounting', 'Business Studies', 'ICT', 'General English', 'General IT'],
				'third': ['Accounting', 'Economics', 'ICT', 'General English', 'General IT'],
				'fourth': ['Accounting', 'Economics', 'Business Statistics', 'General English', 'General IT']
			},
			arts: {
				'first': ['European History', 'Buddhist Civilization', 'Geography', 'General English', 'General IT'],
				'second': ['Political Science', 'English Literature', 'Media Studies', 'General English', 'General IT'],
				'third': ['Economics', 'Sinhala', 'Logic', 'General English', 'General IT']
			}
		};

		// Get subjects from parent page or use empty array
		let selectedSubjects = [];

		// Try to get the selected stream and category from parent page localStorage
		const selectedStream = localStorage.getItem('selectedStream');
		const selectedCategory = localStorage.getItem('selectedCategory');

		if (selectedStream && selectedCategory && subjectCombinations[selectedStream] && subjectCombinations[selectedStream][selectedCategory]) {
			// Get subjects from selected stream and category
			selectedSubjects = subjectCombinations[selectedStream][selectedCategory];
		} else {
			// Try to get any saved subjects
			const savedSubjects = localStorage.getItem('selectedSubjects');
			if (savedSubjects) {
				selectedSubjects = JSON.parse(savedSubjects);
			} else {
				// Default to empty - will show message to select subjects first
				selectedSubjects = [];
			}
		}

		// Subject colors - we'll use a fixed set
		const subjectColors = {
			'Combined Mathematics': '#9C27B0', // Purple
			'Physics': '#F44336', // Red
			'Chemistry': '#2196F3', // Blue
			'Biology': '#4CAF50', // Green
			'ICT': '#FF9800', // Orange
			'General English': '#795548', // Brown
			'General IT': '#607D8B', // Blue Grey
			'Accounting': '#E91E63', // Pink
			'Business Studies': '#009688', // Teal
			'Economics': '#FFEB3B', // Yellow
			'Business Statistics': '#3F51B5', // Indigo
			'European History': '#FF5722', // Deep Orange
			'Buddhist Civilization': '#8BC34A', // Light Green
			'Geography': '#00BCD4', // Cyan
			'Political Science': '#9E9E9E', // Grey
			'English Literature': '#CDDC39', // Lime
			'Media Studies': '#673AB7', // Deep Purple
			'Sinhala': '#FFC107', // Amber
			'Logic': '#03A9F4', // Light Blue
			'Physics/Agriculture': '#F44336' // Same as Physics
		};

		// Default colors for any subjects not in the list
		const defaultColors = [
			'#9C27B0', '#F44336', '#2196F3', '#4CAF50', '#FF9800',
			'#795548', '#607D8B', '#E91E63', '#009688', '#FFEB3B'
		];

		// Get color for a subject
		function getSubjectColor(subject) {
			return subjectColors[subject] || defaultColors[Math.abs(subject.charCodeAt(0)) % defaultColors.length];
		}

		// Month data with first day of the month
		const months = {
			april: { name: 'April 2025', days: 30, firstDay: 2 }, // Tuesday (2)
			may: { name: 'May 2025', days: 31, firstDay: 4 },     // Thursday (4)
			june: { name: 'June 2025', days: 30, firstDay: 0 },   // Sunday (0)
			july: { name: 'July 2025', days: 31, firstDay: 2 },    // Tuesday (2)
			august: { name: 'August 2025', days: 31, firstDay: 5 }, // Friday (5)
			september: { name: 'September 2025', days: 30, firstDay: 1 }, // Monday (1)
			october: { name: 'October 2025', days: 31, firstDay: 3 },    // Wednesday (3)
			november: { name: 'November 2025', days: 30, firstDay: 6 }   // Saturday (6)
		};

		// Days of the week
		const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

		// Initialize study data storage
		let studyData = {};

		// Load saved study data if it exists
		const savedStudyData = localStorage.getItem('studyData');
		if (savedStudyData) {
			studyData = JSON.parse(savedStudyData);
		}

		// Show alert message function
		function showAlert(message, duration = 3000) {
			const alertElement = document.getElementById('alertMessage');
			alertElement.textContent = message;
			alertElement.classList.add('show');
			
			setTimeout(() => {
				alertElement.classList.remove('show');
			}, duration);
		}

		// Populate subject dropdown
		function populateSubjects() {
			const subjectSelect = document.getElementById('subjectSelect');
			subjectSelect.innerHTML = '<option value="">Select subject</option>';
			
			selectedSubjects.forEach(subject => {
				const option = document.createElement('option');
				option.value = subject;
				option.textContent = subject;
				subjectSelect.appendChild(option);
			});
		}

		// Create color legend
		function createColorLegend() {
			const legendContainer = document.getElementById('colorLegend');
			legendContainer.innerHTML = '<h3>Subject Colors</h3>';
			
			selectedSubjects.forEach(subject => {
				const colorItem = document.createElement('div');
				colorItem.className = 'color-item';
				
				const colorDot = document.createElement('div');
				colorDot.className = 'color-dot';
				colorDot.style.backgroundColor = getSubjectColor(subject);
				
				const subjectName = document.createElement('span');
				subjectName.textContent = subject;
				
				colorItem.appendChild(colorDot);
				colorItem.appendChild(subjectName);
				legendContainer.appendChild(colorItem);
			});
		}

		// Create calendars for all months
		function createCalendars() {
			const calendarContainers = document.getElementById('calendarContainers');
			calendarContainers.innerHTML = '';
			
			Object.keys(months).forEach(monthKey => {
				const month = months[monthKey];
				
				// Create calendar container
				const monthContainer = document.createElement('div');
				monthContainer.className = 'month-calendar';
				monthContainer.id = `calendar-${monthKey}`;
				monthContainer.setAttribute('data-month', monthKey);
				
				// Create calendar header
				const calendarContainer = document.createElement('div');
				calendarContainer.className = 'calendar-container';
				
				const calendarHeader = document.createElement('div');
				calendarHeader.className = 'calendar-header';
				calendarHeader.textContent = month.name;
				calendarContainer.appendChild(calendarHeader);
				
				// Create weekday header
				const weekdayHeader = document.createElement('div');
				weekdayHeader.className = 'weekday-header';
				
				daysOfWeek.forEach(day => {
					const dayHeader = document.createElement('div');
					dayHeader.textContent = day;
					weekdayHeader.appendChild(dayHeader);
				});
				
				calendarContainer.appendChild(weekdayHeader);
				
				// Create calendar grid
				const calendarGrid = document.createElement('div');
				calendarGrid.className = 'calendar-grid with-gap';
				
				// Add placeholder for empty cells at the beginning
				for (let i = 0; i < month.firstDay; i++) {
					const placeholder = document.createElement('div');
					placeholder.className = 'grid-placeholder';
					calendarGrid.appendChild(placeholder);
				}
				
				// Create day cards
				for (let day = 1; day <= month.days; day++) {
					const dayCard = createDayCard(monthKey, day);
					calendarGrid.appendChild(dayCard);
				}
				
				calendarContainer.appendChild(calendarGrid);
				monthContainer.appendChild(calendarContainer);
				calendarContainers.appendChild(monthContainer);
			});
			
			// Activate the current month tab and calendar
			const currentDate = new Date();
			const currentMonthName = currentDate.toLocaleString('default', { month: 'long' }).toLowerCase();
			
			// Default to April if current month is not in our range
			const monthToActivate = months[currentMonthName] ? currentMonthName : 'april';
			
			activateMonth(monthToActivate);
			updateStudyData();
		}

		// Create a day card
		function createDayCard(monthKey, day) {
			const dayCard = document.createElement('div');
			dayCard.className = 'day-card';
			dayCard.setAttribute('data-month', monthKey);
			dayCard.setAttribute('data-day', day);
			
			// Check if this is today
			const today = new Date();
			const currentMonth = today.toLocaleString('default', { month: 'long' }).toLowerCase();
			const currentDay = today.getDate();
			
			if (monthKey === currentMonth && day === currentDay) {
				dayCard.classList.add('today');
			}
			
			const dayNumber = document.createElement('div');
			dayNumber.className = 'day-number';
			dayNumber.textContent = day;
			dayCard.appendChild(dayNumber);
			
			const starsDisplay = document.createElement('div');
			starsDisplay.className = 'stars-display';
			starsDisplay.id = `stars-${monthKey}-${day}`;
			dayCard.appendChild(starsDisplay);
			
			// Add day stats tooltip
			const dayStats = document.createElement('div');
			dayStats.className = 'day-stats';
			dayStats.id = `stats-${monthKey}-${day}`;
			dayCard.appendChild(dayStats);
			
			return dayCard;
		}

		// Activate a specific month tab and calendar
		function activateMonth(monthKey) {
			// Deactivate all tabs and calendars
			document.querySelectorAll('.month-tab').forEach(tab => {
				tab.classList.remove('active');
			});
			
			document.querySelectorAll('.month-calendar').forEach(calendar => {
				calendar.classList.remove('active');
			});
			
			// Activate the selected month
			const tabToActivate = document.querySelector(`.month-tab[data-month="${monthKey}"]`);
			if (tabToActivate) {
				tabToActivate.classList.add('active');
			}
			
			const calendarToActivate = document.querySelector(`.month-calendar[data-month="${monthKey}"]`);
			if (calendarToActivate) {
				calendarToActivate.classList.add('active');
			}
		}

		// Handle subject star display
		function displaySubjectStars() {
			// Clear all star displays first
			document.querySelectorAll('.stars-display').forEach(display => {
				display.innerHTML = '';
			});
			
			// Clear all stats displays
			document.querySelectorAll('.day-stats').forEach(stats => {
				stats.innerHTML = '';
			});
			
			// Loop through study data and add stars
			for (const dateKey in studyData) {
				const [year, month, day] = dateKey.split('-');
				const monthName = new Date(year, month - 1, day).toLocaleString('default', { month: 'long' }).toLowerCase();
				
				// Skip if month is not in our display range
				if (!months[monthName]) continue;
				
				const starsDisplayId = `stars-${monthName}-${parseInt(day)}`;
				const statsDisplayId = `stats-${monthName}-${parseInt(day)}`;
				
				const starsDisplay = document.getElementById(starsDisplayId);
				const statsDisplay = document.getElementById(statsDisplayId);
				
				if (!starsDisplay || !statsDisplay) continue;
				
				// Clear displays
				starsDisplay.innerHTML = '';
				
				// Add stars for each subject
				let totalHours = 0;
				let statsHTML = '';
				
				for (const subject in studyData[dateKey]) {
					const hours = studyData[dateKey][subject];
					totalHours += hours;
					
					// Add to stats
					statsHTML += `${subject}: ${hours}h<br>`;
					
					// Calculate number of stars (1 star per hour, round to nearest 0.5)
					const numStars = Math.round(hours * 2) / 2;
					
					// Create stars
					for (let i = 0; i < Math.floor(numStars); i++) {
						addStar(starsDisplay, subject);
					}
					
					// Add half star if needed
					if (numStars % 1 === 0.5) {
						addHalfStar(starsDisplay, subject);
					}
				}
				
				// Set stats tooltip
				statsDisplay.innerHTML = statsHTML + `<strong>Total: ${totalHours.toFixed(2)}h</strong>`;
			}
		}

		// Add a star to display
		function addStar(container, subject) {
			const star = document.createElement('span');
			star.className = 'subject-star';
			star.textContent = '★';
			star.style.color = getSubjectColor(subject);
			star.title = subject;
			container.appendChild(star);
		}

		// Add a half star to display
		function addHalfStar(container, subject) {
			const star = document.createElement('span');
			star.className = 'subject-star';
			star.textContent = '½';
			star.style.color = getSubjectColor(subject);
			star.title = `${subject} (0.5h)`;
			container.appendChild(star);
		}

		// Update study data across the UI
		function updateStudyData() {
			// Save data to localStorage
			localStorage.setItem('studyData', JSON.stringify(studyData));
			
			// Update star displays
			displaySubjectStars();
			
			// Update summary
			updateSummary();
		}

		// Update the summary section
		function updateSummary() {
			const summaryContainer = document.getElementById('subjectSummary');
			summaryContainer.innerHTML = '';
			
			// Calculate total hours per subject
			const subjectTotals = {};
			let grandTotal = 0;
			
			// Initialize totals for all subjects
			selectedSubjects.forEach(subject => {
				subjectTotals[subject] = 0;
			});
			
			// Calculate totals from study data
			for (const dateKey in studyData) {
				for (const subject in studyData[dateKey]) {
					subjectTotals[subject] = (subjectTotals[subject] || 0) + studyData[dateKey][subject];
					grandTotal += studyData[dateKey][subject];
				}
			}
			
			// Calculate target hours (arbitrary - for display purposes)
			const targetHoursPerSubject = {
				'Combined Mathematics': 120,
				'Physics': 100,
				'Chemistry': 100,
				'Biology': 110,
				'ICT': 90,
				'General English': 60,
				'General IT': 40,
				'Accounting': 110,
				'Business Studies': 100,
				'Economics': 100,
				'Business Statistics': 80,
				'European History': 100,
				'Buddhist Civilization': 90,
				'Geography': 100,
				'Political Science': 100,
				'English Literature': 110,
				'Media Studies': 90,
				'Sinhala': 80,
				'Logic': 90,
				'Physics/Agriculture': 100
			};
			
			// Default target hours for subjects not in the list
			const defaultTargetHours = 100;
			
			// Create summary cards for each subject
			selectedSubjects.forEach(subject => {
				const hours = subjectTotals[subject] || 0;
				const target = targetHoursPerSubject[subject] || defaultTargetHours;
				const percentage = Math.min(100, Math.round((hours / target) * 100));
				
				const summaryCard = document.createElement('div');
				summaryCard.className = 'summary-card';
				
				const subjectName = document.createElement('div');
				subjectName.className = 'subject-name';
				subjectName.textContent = subject;
				
				const progressBar = document.createElement('div');
				progressBar.className = 'progress-bar';
				
				const progressFill = document.createElement('div');
				progressFill.className = 'progress-fill';
				progressFill.style.width = `${percentage}%`;
				progressFill.style.backgroundColor = getSubjectColor(subject);
				
				const progressText = document.createElement('div');
				progressText.textContent = `${hours.toFixed(1)} / ${target} hours (${percentage}%)`;
				
				progressBar.appendChild(progressFill);
				
				summaryCard.appendChild(subjectName);
				summaryCard.appendChild(progressBar);
				summaryCard.appendChild(progressText);
				
				summaryContainer.appendChild(summaryCard);
			});
			
			// Add grand total card
			const totalCard = document.createElement('div');
			totalCard.className = 'summary-card';
			totalCard.style.gridColumn = '1 / -1';
			totalCard.style.backgroundColor = 'var(--highlight)';
			totalCard.style.color = 'white';
			
			const totalTitle = document.createElement('div');
			totalTitle.className = 'subject-name';
			totalTitle.textContent = 'Total Study Hours';
			totalTitle.style.fontSize = '1.2rem';
			
			const totalHours = document.createElement('div');
			totalHours.textContent = `${grandTotal.toFixed(1)} hours`;
			totalHours.style.fontSize = '1.5rem';
			totalHours.style.fontWeight = 'bold';
			
			totalCard.appendChild(totalTitle);
			totalCard.appendChild(totalHours);
			
			summaryContainer.appendChild(totalCard);
		}

		// Add new study hours entry
		function addStudyEntry() {
			const subject = document.getElementById('subjectSelect').value;
			const dateInput = document.getElementById('dateSelect').value;
			const hours = parseFloat(document.getElementById('hoursInput').value);
			
			// Validate input
			if (!subject) {
				showAlert('Please select a subject.');
				return;
			}
			
			if (!dateInput) {
				showAlert('Please select a date.');
				return;
			}
			
			if (isNaN(hours) || hours <= 0 || hours > 24) {
				showAlert('Please enter valid hours (between 0.25 and 24).');
				return;
			}
			
			// Format date key
			const dateKey = dateInput; // Already in YYYY-MM-DD format
			
			// Initialize date entry if needed
			if (!studyData[dateKey]) {
				studyData[dateKey] = {};
			}
			
			// Add or update hours
			if (studyData[dateKey][subject]) {
				studyData[dateKey][subject] += hours;
			} else {
				studyData[dateKey][subject] = hours;
			}
			
			// Validate that total hours per day doesn't exceed 24
			let totalHoursForDay = 0;
			for (const subj in studyData[dateKey]) {
				totalHoursForDay += studyData[dateKey][subj];
			}
			
			if (totalHoursForDay > 24) {
				showAlert('Total study hours for this day exceeds 24 hours. Please adjust.');
				// Remove the hours we just added
				if (studyData[dateKey][subject] === hours) {
					delete studyData[dateKey][subject];
				} else {
					studyData[dateKey][subject] -= hours;
				}
				return;
			}
			
			// Update UI
			updateStudyData();
			
			// Clear input fields
			document.getElementById('hoursInput').value = '';
			
			showAlert('Study hours added successfully!', 2000);
		}

		// Clear all study data
		function clearAllData() {
			if (confirm('Are you sure you want to clear all study data? This cannot be undone.')) {
				studyData = {};
				updateStudyData();
				showAlert('All study data has been cleared.');
			}
		}

		// Export study data to CSV
		function exportStudyData() {
			let csvContent = 'Date,Subject,Hours\n';
			
			// Convert study data to CSV rows
			for (const dateKey in studyData) {
				for (const subject in studyData[dateKey]) {
					const hours = studyData[dateKey][subject];
					csvContent += `${dateKey},${subject},${hours}\n`;
				}
			}
			
			// Create download link
			const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
			const url = URL.createObjectURL(blob);
			
			const link = document.createElement('a');
			link.setAttribute('href', url);
			link.setAttribute('download', 'study_data.csv');
			link.style.visibility = 'hidden';
			
			document.body.appendChild(link);
			link.click();
			document.body.removeChild(link);
			
			showAlert('Study data exported successfully!');
		}

		// Initialize the app
		function initApp() {
			// Check if we have selected subjects
			if (selectedSubjects.length === 0) {
				showAlert('Please select your subject stream and combination on the main page first.');
			}
			
			// Populate subject dropdown
			populateSubjects();
			
			// Create color legend
			createColorLegend();
			
			// Create calendars
			createCalendars();
			
			// Set default date to today
			const today = new Date();
			const month = String(today.getMonth() + 1).padStart(2, '0');
			const day = String(today.getDate()).padStart(2, '0');
			document.getElementById('dateSelect').value = `${today.getFullYear()}-${month}-${day}`;
		}

		// Event listeners
		document.getElementById('addEntryBtn').addEventListener('click', addStudyEntry);
		document.getElementById('clearAllBtn').addEventListener('click', clearAllData);
		document.getElementById('exportBtn').addEventListener('click', exportStudyData);

		// Month tab click event listeners
		document.querySelectorAll('.month-tab').forEach(tab => {
			tab.addEventListener('click', function() {
				const monthKey = this.getAttribute('data-month');
				activateMonth(monthKey);
			});
		});

		// Initialize app when DOM is loaded
		document.addEventListener('DOMContentLoaded', initApp);
		
		// Export selected month to PDF
		function exportMonthToPDF() {
			const monthSelect = document.getElementById('pdfMonthSelect');
			const selectedMonth = monthSelect.value;
			
			if (!selectedMonth) {
				showAlert('Please select a month to export.');
				return;
			}

			const monthData = months[selectedMonth];
			if (!monthData) {
				showAlert('Invalid month selected.');
				return;
			}

			const { jsPDF } = window.jspdf;
			const doc = new jsPDF();

			doc.setFont('helvetica', 'bold');
			
			// ===== PAGE 1: Header and Summary Cards =====
			doc.setFontSize(24);
			doc.text('Study Tracker Report', 105, 20, { align: 'center' });

			doc.setFontSize(18);
			doc.text(monthData.name, 105, 30, { align: 'center' });

			const today = new Date();
			doc.setFontSize(10);
			doc.setFont('helvetica', 'normal');
			doc.text(`Generated on: ${today.toLocaleDateString()}`, 105, 40, { align: 'center' });

			const currentYear = new Date().getFullYear();
			const monthNum = Object.keys(months).indexOf(selectedMonth) + 4;
			const monthNumStr = String(monthNum).padStart(2, '0');

			let todayHours = 0;
			let weeklyHours = 0;
			let monthlyHours = 0;

			const todayDate = today.getDate();
			const todayMonth = today.getMonth() + 1;
			const todayMonthStr = String(todayMonth).padStart(2, '0');

			const startOfWeek = new Date(today);
			startOfWeek.setDate(today.getDate() - today.getDay());

			for (const dateKey in studyData) {
				const [year, month, day] = dateKey.split('-');

				if (year == currentYear && month == monthNumStr) {
					let dailyTotal = 0;

					for (const subject in studyData[dateKey]) {
						const hours = studyData[dateKey][subject];
						dailyTotal += parseFloat(hours);
					}

					monthlyHours += dailyTotal;

					if (parseInt(day) === todayDate && month === todayMonthStr) {
						todayHours = dailyTotal;
					}

					const entryDate = new Date(`${year}-${month}-${day}`);
					if (entryDate >= startOfWeek) {
						weeklyHours += dailyTotal;
					}
				}
			}

			// Monthly Hours Card
			doc.setFillColor('#b85b3d');
			doc.roundedRect(140, 50, 50, 40, 3, 3, 'F');
			doc.setFontSize(12);
			doc.setFont('helvetica', 'bold');
			doc.setTextColor(0, 0, 0);
			doc.text("Monthly Hours", 165, 62, { align: 'center' });
			doc.setFontSize(18);
			doc.text(`${monthlyHours.toFixed(1)}h`, 165, 78, { align: 'center' });

			// Weekly Hours Card
			doc.setFillColor('#5cd6bc');
			doc.roundedRect(80, 50, 50, 40, 3, 3, 'F');
			doc.setFontSize(12);
			doc.setFont('helvetica', 'bold');
			doc.setTextColor(0, 0, 0);
			doc.text("Weekly Hours", 105, 62, { align: 'center' });
			doc.setFontSize(18);
			doc.text(`${weeklyHours.toFixed(1)}h`, 105, 78, { align: 'center' });

			// Today's Hours Card
			doc.setFillColor('#95e810');
			doc.roundedRect(20, 50, 50, 40, 3, 3, 'F');
			doc.setFontSize(12);
			doc.setFont('helvetica', 'bold');
			doc.setTextColor(0, 0, 0);
			doc.text("Today's Hours", 45, 62, { align: 'center' });
			doc.setFontSize(18);
			doc.text(`${todayHours.toFixed(1)}h`, 45, 78, { align: 'center' });

			// Subject Summary
			doc.setFontSize(16);
			doc.setFont('helvetica', 'bold');
			doc.text(`Subject Hours Summary`, 105, 110, { align: 'center' });

			const monthlySubjectTotals = {};
			let totalMonthHours = 0;

			selectedSubjects.forEach(subject => {
				monthlySubjectTotals[subject] = 0;
			});

			for (const dateKey in studyData) {
				const [year, month, day] = dateKey.split('-');

				if (year == currentYear && month == monthNumStr) {
					for (const subject in studyData[dateKey]) {
						const hours = parseFloat(studyData[dateKey][subject]) || 0;
						monthlySubjectTotals[subject] = (monthlySubjectTotals[subject] || 0) + hours;
						totalMonthHours += hours;
					}
				}
			}

			doc.setFillColor(230, 230, 230);
			doc.rect(25, 120, 160, 10, 'F');

			doc.setFontSize(12);
			doc.text("Subject", 35, 127);
			doc.text("Hours", 115, 127);
			doc.text("Percentage", 155, 127);

			let yPos = 135;

			selectedSubjects.forEach(subject => {
				const hours = monthlySubjectTotals[subject] || 0;
				const percentage = totalMonthHours > 0 ? Math.round((hours / totalMonthHours) * 100) : 0;

				const colorHex = getSubjectColor(subject);
				const r = parseInt(colorHex.slice(1, 3), 16);
				const g = parseInt(colorHex.slice(3, 5), 16);
				const b = parseInt(colorHex.slice(5, 7), 16);

				doc.setFillColor(r, g, b);
				doc.circle(28, yPos, 3, 'F');

				doc.setFont('helvetica', 'normal');
				doc.setFontSize(11);
				doc.text(subject, 35, yPos + 1);
				doc.text(`${hours.toFixed(1)}h`, 115, yPos + 1);
				doc.text(`${percentage}%`, 155, yPos + 1);

				yPos += 12;
			});

			doc.setFont('helvetica', 'bold');
			doc.setFontSize(12);
			yPos += 5;
			doc.line(25, yPos - 5, 185, yPos - 5);
			doc.text("Total Hours:", 35, yPos + 1);
			doc.text(`${totalMonthHours.toFixed(1)}h`, 115, yPos + 1);
			doc.text("100%", 155, yPos + 1);

			// ===== ✅ FOOTER with link =====
			const pageHeight = doc.internal.pageSize.height;
			const footerText = "Designed by Lakshan";

			// Text color
			doc.setTextColor(120, 80, 50); // Brown
			doc.setFontSize(10);

			// Draw the footer text
			const textWidth = doc.getTextWidth(footerText);
			const xPosition = (doc.internal.pageSize.width - textWidth) / 2;
			const yPosition = pageHeight - 10;

			doc.text(footerText, xPosition, yPosition);

			// Make it clickable
			doc.link(xPosition, yPosition - 3, textWidth, 6, {
				url: "https://wa.me/+94768855659"
			});


			// ===== SAVE =====
			doc.save(`${monthData.name}_study_report.pdf`);
			showAlert(`${monthData.name} study report saved as PDF.`);
		}

		
		// Create floating button to scroll to PDF download section
		function addScrollToPDFButton() {
			// Create the floating button container
			const scrollButtonContainer = document.createElement('div');
			scrollButtonContainer.className = 'scroll-pdf-button-container';
			scrollButtonContainer.style.position = 'fixed';
			scrollButtonContainer.style.bottom = '30px';
			scrollButtonContainer.style.right = '30px';
			scrollButtonContainer.style.zIndex = '9999';
			
			// Create the button itself
			const scrollButton = document.createElement('button');
			scrollButton.textContent = 'Go PDF Download';
			scrollButton.className = 'scroll-pdf-button';
			scrollButton.title = 'Scroll to PDF Download Section';
			
			// Style the button
			scrollButton.style.backgroundColor = '#2e5e5a';
			scrollButton.style.color = 'white';
			scrollButton.style.padding = '12px 20px';
			scrollButton.style.borderRadius = '30px';
			scrollButton.style.border = 'none';
			scrollButton.style.fontSize = '16px';
			scrollButton.style.fontWeight = 'bold';
			scrollButton.style.cursor = 'pointer';
			scrollButton.style.boxShadow = '0 4px 8px rgba(0,0,0,0.3)';
			scrollButton.style.transition = 'all 0.3s ease';
			scrollButton.style.display = 'flex';
			scrollButton.style.alignItems = 'center';
			scrollButton.style.justifyContent = 'center';
			
			// Add PDF icon
			const pdfIcon = document.createElement('span');
			pdfIcon.innerHTML = '📄'; // PDF document emoji
			pdfIcon.style.marginRight = '8px';
			pdfIcon.style.fontSize = '18px';
			scrollButton.prepend(pdfIcon);
			
			// Add arrow up icon
			const arrowIcon = document.createElement('span');
			arrowIcon.innerHTML = ' ↑'; // Up arrow
			arrowIcon.style.marginLeft = '5px';
			scrollButton.appendChild(arrowIcon);
			
			// Add hover effects
			scrollButton.addEventListener('mouseover', () => {
				scrollButton.style.backgroundColor = '#a81169';
				scrollButton.style.boxShadow = '0 6px 12px rgba(0,0,0,0.4)';
				scrollButton.style.transform = 'translateY(-3px)';
			});
			
			scrollButton.addEventListener('mouseout', () => {
				scrollButton.style.backgroundColor = '#2e5e5a';
				scrollButton.style.boxShadow = '0 4px 8px rgba(0,0,0,0.3)';
				scrollButton.style.transform = 'translateY(0)';
			});
			
			// Add click effect
			scrollButton.addEventListener('mousedown', () => {
				scrollButton.style.transform = 'translateY(2px)';
				scrollButton.style.boxShadow = '0 2px 4px rgba(0,0,0,0.2)';
			});
			
			scrollButton.addEventListener('mouseup', () => {
				scrollButton.style.transform = 'translateY(-3px)';
				scrollButton.style.boxShadow = '0 6px 12px rgba(0,0,0,0.4)';
			});
			
			// Add click functionality to scroll to PDF section
			scrollButton.addEventListener('click', () => {
				// Find the export container
				const exportContainer = document.querySelector('.export-container');
				
				if (exportContainer) {
					// Scroll to the export container with smooth animation
					exportContainer.scrollIntoView({ 
						behavior: 'smooth',
						block: 'center'
					});
					
					// Add highlight animation to the export container
					exportContainer.style.animation = 'highlight-pulse 2s ease';
					
					// Remove the animation class after it completes
					setTimeout(() => {
						exportContainer.style.animation = '';
					}, 2000);
				} else {
					console.error('PDF export container not found!');
					alert('PDF download section not found. Please make sure it has been added to the page first.');
				}
			});
			
			// Add CSS for highlight animation
			const style = document.createElement('style');
			style.textContent = `
				@keyframes highlight-pulse {
					0% { box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
					50% { box-shadow: 0 0 25px rgba(76, 175, 80, 0.8); }
					100% { box-shadow: 0 4px 8px rgba(0,0,0,0.15); }
				}
			`;
			document.head.appendChild(style);
			
			// Add button to container and container to document
			scrollButtonContainer.appendChild(scrollButton);
			document.body.appendChild(scrollButtonContainer);
			
			// Add a small bounce animation when the button first appears
			scrollButtonContainer.animate([
				{ transform: 'scale(0)', opacity: 0 },
				{ transform: 'scale(1.2)', opacity: 1 },
				{ transform: 'scale(1)', opacity: 1 }
			], {
				duration: 500,
				easing: 'ease-out'
			});
		}

		// Call the function to add the scroll button
		// Make sure this is called after the PDF export UI has been added
		document.addEventListener('DOMContentLoaded', () => {
			// Wait a short time to ensure the PDF export UI is added first
			setTimeout(() => {
				addScrollToPDFButton();
			}, 1000);
		});

		// Alternative: If you want to manually call this after addPDFExportUI
		// You can add this line at the end of the addPDFExportUI function:
		// addScrollToPDFButton();

		// Create month selection dropdown and export button
		function addPDFExportUI() {
			// Create container
			const exportContainer = document.createElement('div');
			exportContainer.className = 'export-container';
			exportContainer.style.marginTop = '20px';
			exportContainer.style.padding = '50px';
			exportContainer.style.backgroundColor = 'var(--card-bg)';
			exportContainer.style.borderRadius = '12px';
			exportContainer.style.boxShadow = '0 4px 8px rgba(0,0,0,0.15)';
			exportContainer.style.display = 'flex';
			exportContainer.style.flexDirection = 'column';
			exportContainer.style.alignItems = 'center';
			
			// Add header
			const exportHeader = document.createElement('h3');
			exportHeader.textContent = 'Export Month to PDF';
			exportHeader.style.marginBottom = '25px';
			exportHeader.style.color = '#2e5e5a';
			exportHeader.style.fontWeight = 'bold';
			exportContainer.appendChild(exportHeader);
			
			// Create stylish month selection dropdown
			const monthSelectContainer = document.createElement('div');
			monthSelectContainer.style.marginBottom = '25px';
			monthSelectContainer.style.width = '100%';
			monthSelectContainer.style.maxWidth = '350px';
			monthSelectContainer.style.position = 'relative';
			monthSelectContainer.style.display = 'flex';
			monthSelectContainer.style.flexDirection = 'column';
			monthSelectContainer.style.alignItems = 'center';
			
			// Add dropdown label
			const monthLabel = document.createElement('label');
			monthLabel.textContent = 'Select Month';
			monthLabel.setAttribute('for', 'pdfMonthSelect');
			monthLabel.style.marginBottom = '10px';
			monthLabel.style.fontWeight = '600';
			monthLabel.style.color = '#555';
			
			// Create custom select wrapper for styling
			const selectWrapper = document.createElement('div');
			selectWrapper.style.position = 'relative';
			selectWrapper.style.width = '100%';
			
			// Create the select element with improved styling
			const monthSelect = document.createElement('select');
			monthSelect.id = 'pdfMonthSelect';
			monthSelect.style.width = '100%';
			monthSelect.style.padding = '12px 16px';
			monthSelect.style.borderRadius = '8px';
			monthSelect.style.border = '2px solid #ddd';
			monthSelect.style.backgroundColor = '#fff';
			monthSelect.style.appearance = 'none';
			monthSelect.style.cursor = 'pointer';
			monthSelect.style.fontSize = '16px';
			monthSelect.style.color = '#333';
			monthSelect.style.outline = 'none';
			monthSelect.style.transition = 'all 0.3s';
			
			// Add hover and focus effects
			monthSelect.addEventListener('mouseover', () => {
				monthSelect.style.borderColor = '#4CAF50';
			});
			
			monthSelect.addEventListener('mouseout', () => {
				if (document.activeElement !== monthSelect) {
					monthSelect.style.borderColor = '#ddd';
				}
			});
			
			monthSelect.addEventListener('focus', () => {
				monthSelect.style.borderColor = '#4CAF50';
				monthSelect.style.boxShadow = '0 0 5px rgba(76, 175, 80, 0.3)';
			});
			
			monthSelect.addEventListener('blur', () => {
				monthSelect.style.borderColor = '#ddd';
				monthSelect.style.boxShadow = 'none';
			});
			
			// Add dropdown arrow
			const dropdownArrow = document.createElement('span');
			dropdownArrow.innerHTML = '&#9662;'; // Down triangle
			dropdownArrow.style.position = 'absolute';
			dropdownArrow.style.right = '16px';
			dropdownArrow.style.top = '50%';
			dropdownArrow.style.transform = 'translateY(-50%)';
			dropdownArrow.style.pointerEvents = 'none';
			dropdownArrow.style.color = '#4CAF50';
			dropdownArrow.style.fontSize = '16px';
			
			// Add only April to November months options
			const validMonths = ['april', 'may', 'june', 'july', 'august', 'september', 'october', 'november'];
			
			// Add default option
			const defaultOption = document.createElement('option');
			defaultOption.value = '';
			defaultOption.textContent = 'Choose a month...';
			defaultOption.selected = true;
			defaultOption.disabled = true;
			monthSelect.appendChild(defaultOption);
			
			Object.keys(months).forEach(monthKey => {
				if (validMonths.includes(monthKey.toLowerCase())) {
					const option = document.createElement('option');
					option.value = monthKey;
					option.textContent = months[monthKey].name;
					monthSelect.appendChild(option);
				}
			});
			
			// Assemble the select component
			selectWrapper.appendChild(monthSelect);
			selectWrapper.appendChild(dropdownArrow);
			monthSelectContainer.appendChild(monthLabel);
			monthSelectContainer.appendChild(selectWrapper);
			exportContainer.appendChild(monthSelectContainer);
			
			// Create green glow export button
			const exportPDFBtn = document.createElement('button');
			exportPDFBtn.textContent = 'Download PDF Report';
			exportPDFBtn.className = 'action-btn glow-button';
			
			// Apply green glow button styles
			exportPDFBtn.style.backgroundColor = '#4CAF50';
			exportPDFBtn.style.color = 'white';
			exportPDFBtn.style.padding = '14px 24px';
			exportPDFBtn.style.borderRadius = '30px';
			exportPDFBtn.style.border = 'none';
			exportPDFBtn.style.fontSize = '16px';
			exportPDFBtn.style.fontWeight = 'bold';
			exportPDFBtn.style.cursor = 'pointer';
			exportPDFBtn.style.outline = 'none';
			exportPDFBtn.style.transition = 'all 0.3s ease';
			exportPDFBtn.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
			exportPDFBtn.style.position = 'relative';
			exportPDFBtn.style.overflow = 'hidden';
			
			// Add button hover/active states
			exportPDFBtn.addEventListener('mouseover', () => {
				exportPDFBtn.style.backgroundColor = '#45a049';
				exportPDFBtn.style.boxShadow = '0 0 20px rgba(76, 175, 80, 0.8)';
				exportPDFBtn.style.transform = 'translateY(-2px)';
			});
			
			exportPDFBtn.addEventListener('mouseout', () => {
				exportPDFBtn.style.backgroundColor = '#4CAF50';
				exportPDFBtn.style.boxShadow = '0 0 10px rgba(76, 175, 80, 0.5)';
				exportPDFBtn.style.transform = 'translateY(0)';
			});
			
			exportPDFBtn.addEventListener('mousedown', () => {
				exportPDFBtn.style.backgroundColor = '#3d8b40';
				exportPDFBtn.style.boxShadow = '0 0 15px rgba(76, 175, 80, 0.7)';
				exportPDFBtn.style.transform = 'translateY(1px)';
			});
			
			exportPDFBtn.addEventListener('mouseup', () => {
				exportPDFBtn.style.backgroundColor = '#45a049';
				exportPDFBtn.style.boxShadow = '0 0 20px rgba(76, 175, 80, 0.8)';
				exportPDFBtn.style.transform = 'translateY(-2px)';
			});
			
			// Add ripple effect
			exportPDFBtn.addEventListener('click', function(e) {
				exportMonthToPDF();
				
				// Create ripple element
				const ripple = document.createElement('span');
				ripple.classList.add('ripple');
				this.appendChild(ripple);
				
				// Position the ripple
				const x = e.clientX - e.target.getBoundingClientRect().left;
				const y = e.clientY - e.target.getBoundingClientRect().top;
				
				// Style the ripple
				ripple.style.width = ripple.style.height = '100px';
				ripple.style.left = x + 'px';
				ripple.style.top = y + 'px';
				
				// Remove the ripple after animation
				setTimeout(() => {
					ripple.remove();
				}, 600);
			});
			
			// Add ripple style
			const style = document.createElement('style');
			style.textContent = `
				.ripple {
					position: absolute;
					background: rgba(255, 255, 255, 0.5);
					border-radius: 50%;
					transform: scale(0);
					animation: ripple 0.6s linear;
					pointer-events: none;
				}
				
				@keyframes ripple {
					to {
						transform: scale(3);
						opacity: 0;
					}
				}
				
				.glow-button {
					animation: pulse 2s infinite;
				}
				
				@keyframes pulse {
					0% {
						box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
					}
					50% {
						box-shadow: 0 0 20px rgba(76, 175, 80, 0.8);
					}
					100% {
						box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
					}
				}
			`;
			document.head.appendChild(style);
			
			exportContainer.appendChild(exportPDFBtn);
			
			// Add the container to the document - move it to the top of the interface
			const actionPanel = document.getElementById('actionPanel') || document.querySelector('.action-panel');
			if (actionPanel) {
				// Insert at the beginning of the action panel
				actionPanel.insertBefore(exportContainer, actionPanel.firstChild);
			} else {
				// Find the main container
				const mainContainer = document.querySelector('.container') || document.querySelector('main');
				if (mainContainer) {
					// Insert at the top of the main container
					mainContainer.insertBefore(exportContainer, mainContainer.firstChild);
				} else {
					// Last resort: append to body
					document.body.insertBefore(exportContainer, document.body.firstChild);
				}
			}
		}

		// Initialize app when DOM is loaded
		document.addEventListener('DOMContentLoaded', initApp);

		// Add script to load jsPDF library
		function loadJsPDF() {
			return new Promise((resolve, reject) => {
				// Check if jsPDF is already loaded
				if (window.jspdf) {
					resolve();
					return;
				}
				
				const script = document.createElement('script');
				script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
				script.onload = resolve;
				script.onerror = reject;
				document.head.appendChild(script);
			});
		}

		// Initialize PDF functionality
		async function initPDFExport() {
			try {
				await loadJsPDF();
				addPDFExportUI();
			} catch (error) {
				console.error('Failed to load jsPDF library:', error);
				showAlert('Failed to load PDF export functionality. Please try again later.');
			}
		}

		// Call the initialization function when the page loads
		document.addEventListener('DOMContentLoaded', function() {
			// Wait for the main app to initialize first
			setTimeout(initPDFExport, 1000);
		});

		// Add this to your existing code to call PDF export initialization
		if (document.readyState === 'complete') {
			initPDFExport();
		}
	</script>
</body>
</html>
